<!DOCTYPE html>
<html lang="en">

  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="icon" href="/static/favicon.ico">

    <title>Smoke Forecast Verification - FireSmoke.ca</title>
    <link rel="stylesheet" type="text/css" href="/static/css/verify_bluesky.css">
    <link rel="stylesheet" href="https://use.fontawesome.com/releases/v5.8.1/css/all.css"
    integrity="sha384-50oBUHEmvpQ+1lW4y57PTFmhCaXp0ML5d60M1M7uH2+nqUivzIebhndOJK28anvf"
    crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.2.1.slim.min.js" integrity="sha384-KJ3o2DKtIkvYIK3UENzmM7KCkRr/rE9/Qpg6aAZGJwFDMVNA/GpGFF93hXpG5KkN" 
    crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.12.9/umd/popper.min.js" integrity="sha384-ApNbgh9B+Y1QKtv3Rn7W3mgPxhU9K/ScQsAP7hUibX39j7fakFPskvXusvfa0b4Q" 
    crossorigin="anonymous"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0/js/bootstrap.min.js" integrity="sha384-JZR6Spejh4U02d8jOt6vLEHfe/JQGiRRSQQxSfFWpi1MquVdAyjUar5+76PVCmYl" 
    crossorigin="anonymous"></script>
    <!--<script src="https://cdn.jsdelivr.net/npm/leaflet@1.6.0/dist/leaflet.js"></script> -->
    <link href="https://netdna.bootstrapcdn.com/font-awesome/3.2.1/css/font-awesome.css" rel="stylesheet">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/css/bootstrap.min.css">
    <SCRIPT SRC='https://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'></SCRIPT>
    <SCRIPT>MathJax.Hub.Config({ tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']]}})</SCRIPT> 

    
            <meta name="viewport" content="width=device-width,
                initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
            </head>
            <style type="text/css">
              td.partnerlogo {
                line-height: 1.5em;
                margin: 15px;
                padding: 15px;
                vertical-align: center;
              }
            </style>

  <body>
 <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="/">FireSmoke.ca</a>
        </div> <!-- navbar-header -->
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="">
              <a href="/">Home</a></li>
            <li class="dropdown active">
              <a class="dropdown-toggle" aria-expanded="false" role="button" data-toggle="dropdown" href="#">
                Services <span class="caret"></span></a>
              <ul class="dropdown-menu">
                <li><a href="/forecasts">Smoke Forecasts</a></li>
                <li><a href="/smartfire/">SmartFire</a></li>
                <li><a href="/playground">Playground</a></li>
                <li><a href="/data">Data</a></li>
              </ul>
            </li>
            <li class="dropdown">
              <a class="dropdown-toggle" aria-expanded="false" role="button" data-toggle="dropdown" href="#">
                Resources <span class="caret"></span></a>
              <ul class="dropdown-menu" role="menu">
                <li><a href="/national-forum">National Forum</a></li>
                <li><a href="/resources">Resource Directory</a></li>
                <li><a href="/faq">FAQ</a></li>
              </ul>
            </li>
            <li class="">
              <a href="/contact">Contact</a></li>
          </ul>
          <!--
          <form class="navbar-form navbar-right" role="form">
            <div class="form-group">
              <input type="text" placeholder="Email" class="form-control">
            </div>
            <div class="form-group">
              <input type="password" placeholder="Password" class="form-control">
            </div>
            <button type="submit" class="btn btn-success">Sign in</button>
          </form>
          -->
        </div> <!-- navbar-collapse -->
      </div> <!-- container -->
    </div> <!-- navbar -->

    <a name="top"></a>
    <div class="container" role="main" style="margin:50px">
      <div class="page-header">
        <h1>BlueSky Verification - Methodology</h1>
      </div>

      <!-- Intro to Page-->
      <div class="row">
        <div class="col-md-12">
      <p>This verification webpage is to be used to compare the bluesky forecast with observations, 
        as well as to look at some real-time statistics. There are three main parts to this page, 
        the verification map, the statistics, and the individual traces. I will go through each section 
        in detail below, including an explanation and the methodology behind each part. </p>
          </div>
        </div>
        <!-- Verifcation Map Methodology -->
      <a name="verif_maps_method"></a>
      <h2> Verification Map </h2>
      <div class="row">
      <div class="col-sm-12">
      <p> This is a map showing the absolute difference between PM2.5 in the BlueSky Canada forecast and the PM2.5 
        observed at stations throughout BC. It can be interpreted as how well the smoke forecast did at observation
        stations for different windows in time and space. The plots are created with “plotly express”, an interactive
          graphing tool in python. The sliders give users the option to vary the time and spatial windows around the 
          observation points. The scale on the right shows the difference and is split into coloured intervals based 
          on how large the difference is. Red indicates that the difference is larger while green indicates that the
          difference is smaller. This difference should be interpreted as a better forecast if the absolute 
          difference is smaller (green in colour), and a worse forecast if the absolute difference is greater
          (red in colour). This page can be helpful to look at how specific areas in BC are doing, or specific 
          stations, at particular times during the forecast. The DateTime bar below the map can be scrolled, 
          paused, and played to look at a specific time or period of time. </p>
      
      <p>The time and spatial windows determine the period of time and space that the maps look at. The spatial
        and time windows are input to a padding function. This function collects a neighbourhood of data from 
        the model centred around a given station. The values in the spatial data frame for the maps are illustrated
        in the grid below for a spatial window of 0.2°. The nearest neighbour to the observation point at the
        station (point A) is used as the centre of a grid that grows with the spatial window. Then, from this 
        2-d spatial array, the model value closest to the observation value is found. 
      </p>
      <img class="img-fluid" style="width:40%; display:block; margin-left: auto; margin-right: auto;" src="spatial_window.png">

      <p>The absolute difference between the station observation and this forecast output value for the specified window is used 
        as the scale for the verification map. As the spatial and time windows increase, the absolute difference is usually smaller,
        and the forecasts are interpreted as being better. This is useful because for many interpretations of the BlueSky forecast, 
        it does not matter where exactly the smoke is located. Instead, it is just as valuable to know that smoke is forecasted 
        within 10 km. For example, for someone wondering whether their city will be smoky, knowing that smoke is forecasted within
        10 km will be useful.  </p>
    </div>
  </div>
<!-- Verifcation Statistics Methodology -->
  <a name="verif_stats_method"></a>
      <h2> Verification Statistics</h2>
      <div class="row">
        <div class="col-sm-12">
      <p>These statistics are useful to analyze how well the forecast has done on any given day. 
        There are 5 statistics shown for each day: the mean absolute error, the root mean squared
        error, the accuracy, the hit rate, and the false alarm rate. To account for background smoke, 
        I set the observations equal to observations - 10 ug/m^3 (observations’ = observations - 10 ug/m^3).
        Forecast values were left the same (Forecast’ = Forecast). There are statistics averaged over all of 
        the stations in British Columbia, as well as split into three zones in British Columbia and averaged
        over each zone separately. The three zones can be seen below: Northern BC, Interior BC, and Interior BC. </p>
  
          <img class="img-fluid" style="width:40%; display:block; margin-left: auto; margin-right: auto;" src="bc_zones.png">

          <p>The mean absolute error (MAE) and root mean squared errors (RMSE) are computed with the “sklearn.metrics” 
            (scientific python kit) package in python. The mean absolute squared error looks at the absolute difference
            between the forecast and the observations, this will tell us if the forecast is over or under-performing.
            A small MAE suggests that the forecast has done well to predict the observations, and a larger MAE suggests 
            that the forecast did not do a good job predicting the observations. A MAE of zero would mean that the forecast
            was perfect in predicting the PM2.5 observations at every point on a given day. The formula used for calculated 
            the MAE is: 
          </p>
          $$ MAE = \frac{1}{n} \sum |f - o| $$
        
          <p> Where n = total number of stations, &Sigma; = the sum of all of the data points, f = the forecast value,
          o = the observation values. </p>
          <p>The Root-Mean Squared Error (RMSE) is the standard deviation of the residuals (the forecast errors). The RMSE
          essentially tells you how concentrated the data points are around a line of between the forecast and the observation 
          points. The RMSE is calculated by squaring the residuals, finding the average of the residuals, and then taking the
          square root of that value. Again, the RMSE is calculated with the ‘sklearn.mettics’ package in python, with the formula 
          below: </p>

            $$ RMSE = \sqrt \frac{ \sum_{i=1}^n (f - o)^2}{n} $$ 
            <p> Where again, f = the forecast values at each station, o = the observed values at each station, and
              n = the number of stations. </p>
          
            <p>To explain the method behind the hit rate, false alarm rate, correct negatives, and misses, I present
              the following table: 
            </p>

            <table style="float:center; margin-left:auto; margin-right:auto; width: 80%" class="table table-bordered table-striped">
              <th rowspan="2" colspan="2">Contingency Table</th>
              <th colspan="2">Observations' > 0 </th>
              </tr>
              <tr>
              <td>Yes</td>
              <td>No</td>
              </tr>
              <tr>
              <th rowspan="2">Forecast' > 0</th>
              <td>Yes</td>
              <td>Hits </td>
              <td>False Alarms</td>
              </tr>
              <tr>
              <td>No</td>
              <td> Misses</td>
              <td>Correct Negatives</td>
              </tr>
            </table>

        <p> The three statistics that are showed on the page can be defined as:   
          <ul>
            <li> Accuracy =  [(hits + correct negatives)/total] </li>
              <ul>
                <li> This tells us the fraction of forecasts that were correct overall</li>
              </ul>
              <li> Hit Rate =  [hits/(hits + misses)] </li>
              <ul>
                <li> This tells us the fraction of observed "yes" events that were correctly forecast by location</li>
              </ul>
              <li> False Alarm Rate =  [false alarms/(hits + false alarms)] </li>
              <ul>
                <li> This tells us the fraction of "yes" forecast results that were forecast when there was no smoke observed. </li>
              </ul>
          </ul></p>
    <p> A higher accuracy, a higher hit rate, and a lower false alarm rate mean that the forecast is performing better.</p>
</div>
</div>
<!-- Individual Traces Methodology -->
<a name="traces_method"></a>
      <h2> Individual Station Verification</h2>
      <div class="row">
        <div class="col-sm-12">
      <p>The individual station verification displays the raw observations of PM2.5  and the BlueSky smoke forecast + background PM2.5 at
        all stations in British Columbia. To account for background PM2.5 smoke, 10 μg/m3 is added to the forecast data. This value is based 
        on a previous study of 41 stations in Alberta that Rosie Howard had done, where the mean background PM2.5 was found to range between 
        5 μg/m3 and 11 μg/m3. The observed PM2.5 is taken from recorded values from each station, available from the BC government air quality website.
        The BlueSky forecast that is displayed on this page is a 9-point grid point average. As shown below, for the grid point average, the nearest
        neighbour to the observation station point is found in the bluesky model data. Then, a 3x3 array of the bluesky model data with point B
        at the centre is created. The average of these nine points is calculated (the grey shaded box), which gives us the nine-point grid point average. </p>

        <img class="img-fluid" style="width:40%; display:block; margin-left: auto; margin-right: auto;" src="grid_point_average.png">

        <p>This section of the site is particularly useful if you are wondering about a specific time, or a particular station. 
          The plots are created with plotly, an interactive graphing tool in python. The individual facet plots can be zoomed
          in by selecting a box of interest, and each plot will be zoomed to the same time range. The facet plots can also be
          scrolled horizontally and vertically to look at particular stations of interest. 
        </p>
        </div>
        </div>

    <hr>
      <footer>
        <p>© BlueSky Canada 2020</p>
      </footer>

    </div> <!-- main container -->

    <!-- Bootstrap requires jQuery -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.2/jquery.min.js"></script>
    <!-- Bootstrap core JavaScript -->
    <script type="text/javascript" src="Scripts/jquery-2.1.1.min.js"></script>
    <script type="text/javascript" src="Scripts/bootstrap.min.js"></script>
    <!-- IE10 viewport hack for Surface/desktop Windows 8 bug -->
    <script src="/static/js/ie10-viewport-bug-workaround.js"></script>

    <!-- Google analytics -->
    <script>
      (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
      (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
      m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
      })(window,document,'script','https://www.google-analytics.com/analytics.js','ga');

      ga('create', 'UA-103958338-1', 'auto');
      ga('send', 'pageview');

    </script>
    <!-- end Google Analytics -->

  </body>
</html>